# SubDomainSiteScan 

Note: python 3.6

## 功能

对收集的子域名站点进行筛查，并进行分类，根据什么进行判读呢？

请求不存在的资源，若正常提示，则访问主页

（1）状态码：常见200/302/404

（2）标题：对比错误页面及主页的状态码或title内容是否一样（正常或不正常的资源请求）



## 难点

（1）现在主要是根据日常开发的处理思路进行判读，但是可能不能覆盖所有情况

（2）提升效率，使用多进程


## 调研统计
（1）打算对现存活网站进行统计调研，统计下处理方式

结果：404 302 200 



## 思考

怎么样的站点会是不正常的？从请求的过程来思考（发起->dns->代理->网关->服务器）

（1）请求发送失败（dns查询失败、代理拦截、网关不可达、超过TTL等情况）

（2）主页请求500（服务端错误）

（3）正常或不正常的资源请求响应都一样

以上大概率是死站

（4）403，访问受限的站点（这个情况很大可能是有其他限制，需要深入研究）



## 结果分类

（1）正常站点：状态码200/302/404，且错误页面及主页的状态码2xx

（2）死站：请求失败或者状态码5xx，且错误页面及主页的状态码或title内容一样

（3）异常站点：状态码403


## 主逻辑

1.发起请求1：不存在的资源

2.条件：请求失败或者状态码5xx，

   是，则存入死站分类，返回步骤1；
   
   否，则发起请求2：主页
   
3.主要条件（判断是否正常站点）：请求1状态码2xx或404 且 请求2状态2xx 且 请求1跟请求2的title不同

  比较title主要怕正常、异常响应都是一样，这就不正常了；一般主页肯定是有title，如果是异常返回json的情况，就会没有title，所以只要不一样就可以

   否，则存入可疑站点分类，返回步骤1
   
   是，则存入正常站点分类

## 代码结构

- SubDomainSiteScan.py        主函数，入参：子域名列表，返回：无

- util/getStatusAndTtile.py   发送请求，获取状态码及title，入参：url，返回：列表【url，status，title】

- util/getRandomUrl.py        生成随机资源url，不存在的资源url，入参：子域名，返回：随机

- urlutil/report.py              输出报告文件，入参：报告文件名，数据列表【url，status，title】，返回：无

- report                      报告目录